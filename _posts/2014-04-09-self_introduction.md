---
layout: post
title:  "liu xiong's 博客"
categories: self
---

大学期间学习的专业是电子类的，也就接触了很多嵌入式软件。也玩过几个嵌入式操作系统，一般就是简单的多任务加简单的内存管理之类的系统。印象最深刻的就是将ucos内核移植到低端的DSP上，当时觉得很有成就感，于是后面我就去看Linux内核，发现它与那些实时系统复杂多了。当时为了看懂Linux内核原理，买了厚厚的一本《Linux源码剖析》开始钻研Linux源码，加上操作系统原理，懂了个大概，对操作系统的多进程机制和内存管理有了比较深的认识。

大学有一段时间很是痴迷于C++，因为之前没接触过面向对象语言，花了不少时间把《C++ Primer》看了一两遍，对C++语法层面有了一些了解。记得当时侯杰的一本《STL源码剖析》评价很高，但是要对算法和数据结构比较熟悉。于是我开始看各种算法和数据结构，因为STL使用了大量模板，于是又找了本《模板编程》，好好复习了一下模板知识，当我自认为模板掌握的比较清楚的时候，就拿起《STL源码剖析》再加上SGI STL源码进行分析，当时看STL源码的时候非常兴奋，因为我发现它的实现真的很巧妙，把C++的模板特性使用的淋漓尽致，并且迭代器模式也很巧妙，它分离了数据结构和算法，使得数据结构和算法能够复用。之后又琢磨了一下《C++对象模型》，对C++的语言构造有了一些认识。

像很多人学编程的目的是为了能够自己开发游戏一样，于是我开始翻阅各种有关游戏的资料。当时为了开发windows上的游戏，我买了《Windows程序设计》两套书，开始学习用C语言开发windows程序。这本书带我进入了windows编程的殿堂，使我认识了编程的乐趣。并学会了使用GDI来绘图。然后我就写了几个简单的游戏如扫雷、俄罗斯方块之类的练手，对C++和windows编程的认识又提高了很多。之后又继续学习了MFC类库和COM组件，并看了《windows核心编程》熟悉了windows的一些系统组件。

毕业之后去了一家嵌入式公司做软件开发。主要做PC端软件开发。使用MFC做界面开发，但是MFC毕竟太老了，界面做起来也不美观，于是我引入了开源库Duilib来进行界面开发。Duilib是一个directUi界面库，使用XML来描述界面。Duilib内置一些常用控件，能减少很多工作量，但是有些专属控件就只能通过插件的形式动态创建。由于Duilib没有好的编辑工具，我们都是使用手工编辑XML文件来生成界面。Duilib毕竟缺少生态系统，需要耗费很多时间去研究Duilib源代码。之后有一些桌面软件我们使用了WPF来开发，WPF也是使用XML来描述界面，它的工具很完整，并且C#的接口也很简单易懂。

在之前的公司呆了两年，主要做windows桌面端的界面和数据有关的开发工作。为了不阻塞UI，我们需要使用多线程。于是我就使用了chromium的线程方案和它的MessageLoop。

为了不阻塞IO，我们需要将IO阻塞操作和其他费事的操作放到其他线程执行。为了让不同线程的对象交互，我们使用了消息来进行交互。我们应该尽量避免使用锁，而是让对象属于一个线程，线程间采用消息进行通信。chromium中每个线程都有自己的MessageLoop，线程之间采用任务回调函数来进行通信。具体来说，每个对象都属于一个线程，当我们在其他线程请求这个对象时，我们需要将这个请求封装成一个任务Post到对象所在的线程去执行，这样能够避免使用锁带来的负面影响。

因为每个创建的线程都有消息循环，我们不应该使用阻塞操作，因为他会阻塞线程的消息队列，使得线程消息得不到及时处理，从而降低系统性能。为了增强性能，我们需要使用异步IO或者完成端口(windows)来进行IO操作，避免阻塞。chromium中很多API都是异步的。因此使用chromium来进行异步IO能减少很多开发时间。

chromium采用多进程架构。这样的好处就是能够隔离每个渲染进程。chromium有个主进程，用来进行初始化、与渲染进程进行通信和UI渲染。浏览器的每个Tab都有一个渲染进程进行渲染，HTTP请求和交互，以及webkit引擎都运行渲染进程中，渲染进程和主进程通过IPC进行交互，例如当webkit分析完成，需要界面更新时，就会发送更新消息给主进程。

学习使用gyp来开发基于chromium的跨平台程序。使用gyp来生成对应平台的编程环境(windows下的VS)，当你习惯了之后，就会发现gyp对于开发跨平台程序效率是很高的。

有一段时间学习了一下前端开发技术，发现前端的开源库相当之多，html和js的威力很大。在众多的开源库帮助下，要写出一个交互性不太强的UI是很容易的一件事情。使用jQuery来操作DOM是一件非常容易的事情，使用bootstrap这个css库来进行布局，能够轻易的写出响应式的web页面，使用AngularJs这个MVC框架可以写出很棒的静态页面。
说道AngularJs，它的数据绑定，自定义控制器，依赖注入这些特性非常强大，能够显著较少DOM操作，增加代码的可读性和可测试性。

了解了前端技术，不得不说js的后端开发框架nodejs。nodejs在github上运用的非常多，它的基于事件编程和异步IO的特性都让我印象深刻，单线程的特性让我从线程交互中解脱出来。nodejs的缺点就是异步回调函数会降低程序的可读性和可调试性，还有就是回调嵌套的问题，可以使用async这些库来减少调用嵌套。不过总体来说，还是非常好用的一个平台，可以尝试使用。使用nodejs最大的好处是我认识了很多的开源项目，有使用前端技术来开发桌面应用的node webkit，有后端MVC框架express，有前端包管理器bower，集成自动化工具Grunt，还有CNode网站源码node club等等，这些都让我学习了很多。